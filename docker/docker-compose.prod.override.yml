services:
  nginx:
    env_file: prod.env
    build:
        args: 
          - targetENV=prod
    ports: 
         - 8500:8500
    volumes:
       - C:/Users/User/certificates/self-signed-custom-ca/nginx.key:/etc/nginx/ssl/nginx.key
       - C:/Users/User/certificates/self-signed-custom-ca/nginx.crt:/etc/nginx/ssl/nginx.crt
    networks:
         - mynetwork-prod
         - product-svcs-prod
         - cart-svcs-prod

  express-gateway-service-1:
      env_file: prod.env
      environment:
        - EXPRESS_GATEWAY_PORT_SSL=8305
        - EXPRESS_GATEWAY_NAME=express-gateway-service-1
      build:
        args: 
          - targetENV=prod
      volumes:
        - C:/Users/User/certificates/self-signed-custom-ca/express.key:/var/lib/certs/express.key
        - C:/Users/User/certificates/self-signed-custom-ca/express.crt:/var/lib/certs/express.crt
        - C:/Users/User/certificates/self-signed-custom-ca/rootCA.crt:/var/lib/certs/rootCA.crt
      ports: 
         - 8305:8305
      networks:
         - mynetwork-prod
         - product-svcs-prod
         - cart-svcs-prod

  express-gateway-service-2:
       env_file: prod.env
       environment:
        - EXPRESS_GATEWAY_PORT_SSL=8306
        - EXPRESS_GATEWAY_NAME=express-gateway-service-2
       build:
        args: 
          - targetENV=prod 
       volumes:
        - C:/Users/User/certificates/self-signed-custom-ca/express.key:/var/lib/certs/express.key
        - C:/Users/User/certificates/self-signed-custom-ca/express.crt:/var/lib/certs/express.crt
        - C:/Users/User/certificates/self-signed-custom-ca/rootCA.crt:/var/lib/certs/rootCA.crt
       ports: 
         - 8306:8306
       networks:
         - mynetwork-prod
         - product-svcs-prod
         - cart-svcs-prod

  express-gateway-service-3:
      env_file: prod.env
      environment:
        - EXPRESS_GATEWAY_PORT_SSL=8307
        - EXPRESS_GATEWAY_NAME=express-gateway-service-3
      build:
        args: 
          - targetENV=prod
      volumes:
        - C:/Users/User/certificates/self-signed-custom-ca/express.key:/var/lib/certs/express.key
        - C:/Users/User/certificates/self-signed-custom-ca/express.crt:/var/lib/certs/express.crt
        - C:/Users/User/certificates/self-signed-custom-ca/rootCA.crt:/var/lib/certs/rootCA.crt
      ports: 
         - 8307:8307
      networks:
         - mynetwork-prod
         - product-svcs-prod
         - cart-svcs-prod